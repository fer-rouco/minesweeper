import{a as E}from"./chunk-GOZOD6V3.js";import{b as K}from"./chunk-R76UL7FA.js";import{a as N,b as R,c as k}from"./chunk-6PYATZXB.js";import{a as $}from"./chunk-IHHOGQ75.js";import{B as p,C as _,G as Q,I as B,J as P,K as W,L as G,M as D,N as y,O as c,P as h,Q as f,R as Y,S as C,T,W as I,X as b,Z as O,c as z,ha as X,k as H,pa as q,t as J,u as V,ua as Z,v as w,va as L,z as g}from"./chunk-OQAQO3FB.js";var F=class{constructor(){this.id=0,this.type=m.EMPTY,this.discovered=!1,this.flag=!1,this.number=0}getId(){return this.id}setId(i){this.id=i}getType(){return this.type}setType(i){this.type=i}isDiscovered(){return this.discovered}setDiscovered(i){this.discovered=i}getNumber(){return this.number}setNumber(i){this.number=i}setFlag(i){this.flag=i}isFlag(){return this.flag}isType(i){return this.getType()===i}isTypeEmpty(){return this.isType(m.EMPTY)}isTypeNumber(){return this.isType(m.NUMBER)}isTypeBomb(){return this.isType(m.BOMB)}isTypeExplosion(){return this.isType(m.EXPLOSION)}isNumber(i){return this.getNumber()===i}},m=function(n){return n[n.EMPTY=0]="EMPTY",n[n.NUMBER=1]="NUMBER",n[n.BOMB=2]="BOMB",n[n.EXPLOSION=4]="EXPLOSION",n}(m||{});function re(n,i){n&1&&f(0,"img",5)}function ne(n,i){n&1&&f(0,"img",6)}var te=(()=>{let i=class i{constructor(r,t,e){this.configService=r,this.boardService=t,this.cdr=e,this.timerIntervalSubscription=z.EMPTY,this.elapsedTime=w(0),this.flagsCounter=w(0),this.gameOver=w(!1)}ngOnInit(){this.resetFlagCounter(),this.boardService.getStartNewGameObservable().subscribe(()=>{this.startGame()}),this.boardService.getStartTimerObservable().subscribe(()=>{this.startTimer()}),this.boardService.getGameOverObservable().subscribe(r=>{this.gameOver.set(r),this.stopTimer()}),this.boardService.getUpdateFlagCounterObservable().subscribe(r=>{this.flagsCounter.set(this.configService.getConfig().getBombs()-r)})}ngOnDestroy(){this.stopTimer()}startTimer(){this.timerIntervalSubscription=H(1e3).subscribe(()=>{this.elapsedTime.set(this.elapsedTime()+1),this.cdr.detectChanges()})}stopTimer(){this.timerIntervalSubscription.unsubscribe()}startGame(){this.gameOver.set(!1),this.elapsedTime.set(0),this.resetFlagCounter()}restartGame(){this.boardService.resetGame(),this.startGame(),this.stopTimer()}resetFlagCounter(){this.flagsCounter.set(this.configService.getConfig().getBombs())}};i.\u0275fac=function(t){return new(t||i)(p(E),p(k),p(X))},i.\u0275cmp=_({type:i,selectors:[["board-header"]],decls:12,vars:3,consts:[[1,"board-header"],[1,"board-header-display-container"],[1,"board-header-display-container__icon","icon-bomb"],["id","flag-counter",1,"board-header-display-container__label"],[1,"board-header__button",3,"click"],["src","assets/icons/face_unpressed.svg","title","Restart Game",1,"board-header__face"],["src","assets/icons/face_loose.svg","title","Restart Game",1,"board-header__face"],[1,"board-header-display-container__icon","icon-clock"],["id","timer",1,"board-header-display-container__label"]],template:function(t,e){t&1&&(c(0,"div",0)(1,"div",1),f(2,"i",2),c(3,"span",3),b(4),h()(),c(5,"custom-button",4),C("click",function(){return e.restartGame()}),B(6,re,1,0,"img",5)(7,ne,1,0,"img",6),h(),c(8,"div",1),f(9,"i",7),c(10,"span",8),b(11),h()()()),t&2&&(g(4),O(" ",e.flagsCounter()),g(2),P(e.gameOver()?7:6),g(5),O(" ",e.elapsedTime()))},dependencies:[Z],styles:["[_nghost-%COMP%]{--border-radius: .5rem;--control-border: .5px solid rgb(180, 180, 180);--control-border-focus: .5px solid rgb(146, 146, 250);--control-border-radius: var(--border-radius);--control-margin: 0 1rem 1rem 1rem;--control-padding: .5rem;--asset-icon-down-arrow: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAUCAMAAACtdX32AAAAdVBMVEUAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAhMdQaAAAAJ3RSTlMAAAECAwQGBwsOFBwkJTg5RUZ4eYCHkJefpaytrsXGy8zW3+Do8vNn0bsyAAAAYElEQVR42tXROwJDQAAA0Ymw1p9kiT+L5P5HVEi3qJn2lcPjtIuzUIJ/rhIGy762N3XaThqMN1ZPALsZPEzG1x8LrFL77DHBnEMxBewz0fJ6LyFHTPL7xhwzWYrJ9z22AqmQBV757MHfAAAAAElFTkSuQmCC);--asset-icon-filled-tile: url(file://assets/icons/filled-tile.svg);--asset-icon-flag: url(file://assets/icons/flag.svg);--asset-icon-bomb: url(file://assets/icons/bomb.png);--asset-icon-explosion: url(file://assets/icons/explosion.png);--asset-icon-clock: url(file://assets/icons/clock.svg)}.board-header[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;align-items:center;margin-bottom:1rem}.board-header[_ngcontent-%COMP%]   .board-header-display-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.5rem;background-color:#fff;border-radius:var(--border-radius)}.board-header[_ngcontent-%COMP%]   .board-header-display-container__icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:cover;height:1.5rem;width:1.5rem;display:block}.board-header[_ngcontent-%COMP%]   .board-header-display-container__icon.icon-bomb[_ngcontent-%COMP%]{background-image:var(--asset-icon-bomb)}.board-header[_ngcontent-%COMP%]   .board-header-display-container__icon.icon-clock[_ngcontent-%COMP%]{background-image:var(--asset-icon-clock)}.board-header[_ngcontent-%COMP%]   .board-header-display-container__label[_ngcontent-%COMP%]{margin-left:1rem;font-size:1.2rem}.board-header[_ngcontent-%COMP%]     .custom-button{border:none;margin-bottom:0}.board-header[_ngcontent-%COMP%]     .custom-button .board-header__face{background-repeat:no-repeat;background-size:cover;height:3rem;width:3rem}"]});let n=i;return n})();function oe(n,i){if(n&1&&(c(0,"span",2),b(1),h()),n&2){let A=T();I("one",A.tile.isNumber(1))("two",A.tile.isNumber(2))("three",A.tile.isNumber(3))("four",A.tile.isNumber(4))("five",A.tile.isNumber(5))("six",A.tile.isNumber(6)),g(),O(" ",A.tile.getNumber()," ")}}var ie=(()=>{let i=class i{constructor(){this.TileTypes=m,this.tile=void 0,this.change=new Q,this.gameOver=!1}updateType(){this.gameOver||this.tile&&(this.tile.isDiscovered()||this.tile.isFlag()||(this.tile.isTypeBomb()&&(this.tile.setType(this.TileTypes.EXPLOSION),this.tile.setDiscovered(!0)),(this.tile.isTypeBomb()||this.tile.isTypeEmpty()||this.tile.isTypeNumber())&&this.tile.setDiscovered(!0)))}onClick(){this.tile&&(this.updateType(),this.change.next(this.tile))}onContextMenuClick(r){r.preventDefault(),!this.gameOver&&this.tile&&(this.tile.isDiscovered()||(this.tile.setFlag(!this.tile.isFlag()),this.change.next(this.tile)))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=_({type:i,selectors:[["tile"]],inputs:{tile:"tile",gameOver:"gameOver"},outputs:{change:"change"},decls:2,vars:10,consts:[[1,"tile",3,"click","contextmenu","id"],[1,"tile__number",3,"one","two","three","four","five","six"],[1,"tile__number"]],template:function(t,e){t&1&&(c(0,"span",0),C("click",function(){return e.onClick()})("contextmenu",function(d){return e.onContextMenuClick(d)}),B(1,oe,2,13,"span",1),h()),t&2&&(I("filled",!(e.tile!=null&&e.tile.isDiscovered())&&((e.tile==null?null:e.tile.isTypeEmpty())||(e.tile==null?null:e.tile.isTypeNumber())||(e.tile==null?null:e.tile.isTypeBomb())))("bomb",(e.tile==null?null:e.tile.isDiscovered())&&(e.tile==null?null:e.tile.isTypeBomb()))("explosion",(e.tile==null?null:e.tile.isDiscovered())&&(e.tile==null?null:e.tile.isTypeExplosion()))("flag",!(e.tile!=null&&e.tile.isDiscovered())&&(e.tile==null?null:e.tile.isFlag())),y("id","tile-"+(e.tile==null?null:e.tile.getId())),g(),P(e.tile&&e.tile.getNumber()>0&&e.tile.isDiscovered()?1:-1))},styles:[".tile[_ngcontent-%COMP%]{cursor:pointer;display:flex;justify-content:center;align-items:center;background-repeat:no-repeat;background-size:cover;height:2rem;width:2rem}.tile.filled[_ngcontent-%COMP%]{background-image:var(--asset-icon-filled-tile)}.tile.flag[_ngcontent-%COMP%]{background-image:var(--asset-icon-flag)}.tile.bomb[_ngcontent-%COMP%]{background-image:var(--asset-icon-bomb)}.tile.explosion[_ngcontent-%COMP%]{background-image:var(--asset-icon-explosion)}.tile__number[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:bolder}.tile__number.one[_ngcontent-%COMP%]{color:#00f}.tile__number.two[_ngcontent-%COMP%]{color:#007800}.tile__number.three[_ngcontent-%COMP%]{color:red}.tile__number.four[_ngcontent-%COMP%]{color:#00007f}.tile__number.five[_ngcontent-%COMP%]{color:#7b0000}.tile__number.six[_ngcontent-%COMP%]{color:#a2ad00}"]});let n=i;return n})();var se=(n,i)=>i.getId();function ae(n,i){if(n&1){let A=Y();c(0,"td",3)(1,"tile",4),C("change",function(t){J(A);let e=T(2);return V(e.onTileChange(t))}),h()()}if(n&2){let A=i.$implicit,r=T(2);g(),y("tile",A)("gameOver",r.gameOver)}}function le(n,i){if(n&1&&(c(0,"tr",2),G(1,ae,2,2,"td",3,se),h()),n&2){let A=i.$implicit;g(),D(A)}}function ce(n,i){n&1&&b(0," There were no items in the list. ")}var Ie=(()=>{let i=class i{constructor(r,t,e,o){this.router=r,this.configService=t,this.boardService=e,this.notificationService=o,this.ActionHelper=N,this.grid=[],this.gameOver=!1,this.gameStart=null,this.config=this.configService.getConfig()}ngOnInit(){this.configService.restoreConfig(),this.config=this.configService.getConfig(),this.newGame(),this.boardService.getResetGameObservable().subscribe(()=>{this.newGame()})}navigateToFinishedGameList(){this.router.navigateByUrl("/finished-games-list")}newGame(){this.notificationService.clear(),this.initGrid(),this.updateGridWithRandomBombs(),this.updateGridWithNumbers(),this.gameOver=!1,this.gameStart=null,this.boardService.startNewGame()}initGrid(){let r=0;for(let t=0;t<this.config.getRows();t++){this.grid[t]=[];for(let e=0;e<this.config.getColumns();e++){let o=new F;o.setId(++r),this.grid[t][e]=o}}}updateGridWithRandomBombs(){let r=0;for(;r<this.config.getBombs();){let t=Math.floor(Math.random()*this.config.getRows()),e=Math.floor(Math.random()*this.config.getColumns());this.grid[t][e].isTypeBomb()||(this.grid[t][e].setType(m.BOMB),r++)}}updateGridWithNumbers(){let r=(t,e)=>{let o=this.grid[t];if(o){let d=o[e];d&&!d.isTypeBomb()&&(d.setNumber(d.getNumber()+1),d.setType(m.NUMBER))}};for(let t=0;t<this.config.getRows();t++)for(let e=0;e<this.config.getColumns();e++)this.grid[t][e].isTypeBomb()&&(r(t-1,e-1),r(t,e-1),r(t+1,e-1),r(t-1,e),r(t+1,e),r(t-1,e+1),r(t,e+1),r(t+1,e+1))}updateFlagCounter(){let r=this.grid.flat().filter(t=>t.isFlag()).length;this.boardService.updateFlagCounter(r)}onTileChange(r){let t=r.getType();if(t===m.EXPLOSION&&!this.gameOver?(this.boardService.registerFinishedGameItem(this.gameStart,new Date,this.config.getDifficultyLevel(),R.LOOSE),this.boardService.gameOver(!0),this.gameOver=!0,this.notificationService.addError("Game Over!",N.buildFuctionAction({id:"try-again",label:"Try Again.",fn:()=>{this.newGame()},type:L.LINK})),this.grid.flat().forEach(e=>{!e.isDiscovered()&&e.isTypeBomb()&&e.setDiscovered(!0)})):t===m.EMPTY&&!r.isFlag()&&this.updateAdjacentTilesShowFlagWhenAEmptyTileWasClicked(r),!this.gameOver){let e=this.grid.flat().filter(o=>o.isDiscovered()&&!o.isTypeBomb()).length;e>0&&!this.gameStart&&(this.gameStart=new Date,this.boardService.startTimer()),e===this.config.getCells()-this.config.getBombs()&&(this.boardService.registerFinishedGameItem(this.gameStart,new Date,this.config.getDifficultyLevel(),R.WIN),this.boardService.gameOver(!1),this.notificationService.addSuccess("Game Won!",N.buildFinishedGameListAction({label:"Check your results.",type:L.LINK}))),this.updateFlagCounter()}}findRowAndColumn(r){let t=-1,e=-1;return this.grid.findIndex((o,d)=>{let u=o.findIndex(M=>M===r);return u!==-1?(t=d,e=u,!0):!1}),t!==-1&&e!==-1?{row:t,column:e}:{row:-1,column:-1}}updateAdjacentTilesShowFlagWhenAEmptyTileWasClicked(r){let t=this.findRowAndColumn(r),e=t?.row,o=t?.column,d=[],u=(l,s)=>l>-1&&s>-1&&l<this.config.getRows()&&s<this.config.getColumns()&&!d.some(a=>a.column===s&&a.row===l)?{row:l,column:s}:null,M=(l,s)=>{let a=[];return a.push(u(l-1,s-1)),a.push(u(l,s-1)),a.push(u(l+1,s-1)),a.push(u(l-1,s)),a.push(u(l+1,s)),a.push(u(l-1,s+1)),a.push(u(l,s+1)),a.push(u(l+1,s+1)),a.filter(S=>S!==null)},x=l=>{l.forEach(s=>{let a=s.row,S=s.column;if(this.grid[a]){let v=this.grid[a][S];if(v&&((v.isTypeEmpty()||v.isTypeNumber()&&!v.isFlag())&&v.setDiscovered(!0),v.isTypeEmpty())){let U=M(a,S);d.push(...U),x(U)}}})},j=M(e,o);d.push(...j),x(j)}};i.\u0275fac=function(t){return new(t||i)(p(q),p(E),p(k),p(K))},i.\u0275cmp=_({type:i,selectors:[["app-board"]],decls:7,vars:2,consts:[["title","Board",1,"board",3,"actions"],[1,"board__grid"],[1,"row"],[1,"col"],[3,"change","tile","gameOver"]],template:function(t,e){t&1&&(c(0,"panel",0),f(1,"board-header"),c(2,"div",1)(3,"table"),G(4,le,3,0,"tr",2,W,!1,ce,1,0),h()()()),t&2&&(y("actions",e.ActionHelper.buildBoardActions()),g(4),D(e.grid))},dependencies:[$,te,ie],styles:["[_nghost-%COMP%]{--border-radius: .5rem;--control-border: .5px solid rgb(180, 180, 180);--control-border-focus: .5px solid rgb(146, 146, 250);--control-border-radius: var(--border-radius);--control-margin: 0 1rem 1rem 1rem;--control-padding: .5rem;--asset-icon-down-arrow: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAUCAMAAACtdX32AAAAdVBMVEUAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAhMdQaAAAAJ3RSTlMAAAECAwQGBwsOFBwkJTg5RUZ4eYCHkJefpaytrsXGy8zW3+Do8vNn0bsyAAAAYElEQVR42tXROwJDQAAA0Ymw1p9kiT+L5P5HVEi3qJn2lcPjtIuzUIJ/rhIGy762N3XaThqMN1ZPALsZPEzG1x8LrFL77DHBnEMxBewz0fJ6LyFHTPL7xhwzWYrJ9z22AqmQBV757MHfAAAAAElFTkSuQmCC);--asset-icon-filled-tile: url(file://assets/icons/filled-tile.svg);--asset-icon-flag: url(file://assets/icons/flag.svg);--asset-icon-bomb: url(file://assets/icons/bomb.png);--asset-icon-explosion: url(file://assets/icons/explosion.png);--asset-icon-clock: url(file://assets/icons/clock.svg)}.board[_ngcontent-%COMP%]{view-transition-name:scale3d}.board__grid[_ngcontent-%COMP%]{display:flex;justify-content:center}.board[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%], .board[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{border:1px solid #808080}"]});let n=i;return n})();export{Ie as BoardComponent};
