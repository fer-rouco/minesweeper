import{a as k}from"./chunk-ZKYREIS4.js";import{a as G,b as L,c as D}from"./chunk-NNBPAJ3M.js";import"./chunk-LZTFHIOT.js";import{$ as q,A as Y,B as z,F as w,G as p,H as f,I as V,J as K,L as F,M as y,N as E,O as Q,P as R,Q as A,R as d,S as h,T as b,U as $,V as O,W as S,X as v,Y as M,Z as T,_ as Z,c as U,da as J,ea as ee,ja as te,k as X,la as ie,ma as j,na as re,ra as ne,ta as N,y as C}from"./chunk-IS7UHNAX.js";var I=class{constructor(){this.id=0,this.type=u.EMPTY,this.discovered=!1,this.flag=!1,this.number=0}getId(){return this.id}setId(i){this.id=i}getType(){return this.type}setType(i){this.type=i}isDiscovered(){return this.discovered}setDiscovered(i){this.discovered=i}getNumber(){return this.number}setNumber(i){this.number=i}setFlag(i){this.flag=i}isFlag(){return this.flag}isType(i){return this.getType()===i}isTypeEmpty(){return this.isType(u.EMPTY)}isTypeNumber(){return this.isType(u.NUMBER)}isTypeBomb(){return this.isType(u.BOMB)}isTypeExplosion(){return this.isType(u.EXPLOSION)}isNumber(i){return this.getNumber()===i}},u=function(n){return n[n.EMPTY=0]="EMPTY",n[n.NUMBER=1]="NUMBER",n[n.BOMB=2]="BOMB",n[n.EXPLOSION=4]="EXPLOSION",n}(u||{});function le(n,i){n&1&&b(0,"img",8)}function ce(n,i){n&1&&b(0,"img",9)}var se=(()=>{let i=class i{constructor(r,t,e){this.configService=r,this.boardService=t,this.cdr=e,this.timerIntervalSubscription=U.EMPTY,this.elapsedTime=w(0),this.flagsCounter=w(0),this.gameOver=w(!1)}ngOnInit(){this.resetFlagCounter(),this.boardService.getStartNewGameObservable().subscribe(()=>{this.startGame()}),this.boardService.getStartTimerObservable().subscribe(()=>{this.startTimer()}),this.boardService.getGameOverObservable().subscribe(r=>{this.gameOver.set(r),this.stopTimer()}),this.boardService.getUpdateFlagCounterObservable().subscribe(r=>{this.flagsCounter.set(this.configService.getConfig().getBombs()-r)})}ngOnDestroy(){this.stopTimer()}startTimer(){this.timerIntervalSubscription=X(1e3).subscribe(()=>{this.elapsedTime.set(this.elapsedTime()+1),this.cdr.detectChanges()})}stopTimer(){this.timerIntervalSubscription.unsubscribe()}startGame(){this.gameOver.set(!1),this.elapsedTime.set(0),this.resetFlagCounter()}restartGame(){this.boardService.resetGame(),this.startGame(),this.stopTimer()}resetFlagCounter(){this.flagsCounter.set(this.configService.getConfig().getBombs())}};i.\u0275fac=function(t){return new(t||i)(f(k),f(D),f(V))},i.\u0275cmp=C({type:i,selectors:[["board-header"]],standalone:!0,features:[T],decls:12,vars:3,consts:[[1,"board-header"],[1,"board-header-display-container"],[1,"board-header-display-container__icon","icon-bomb"],["id","flag-counter",1,"board-header-display-container__label"],[1,"board-header__button",3,"click"],["class","board-header__face","src","assets/icons/face_unpressed.svg","title","Restart Game"],[1,"board-header-display-container__icon","icon-clock"],["id","timer",1,"board-header-display-container__label"],["src","assets/icons/face_unpressed.svg","title","Restart Game",1,"board-header__face"],["src","assets/icons/face_loose.svg","title","Restart Game",1,"board-header__face"]],template:function(t,e){t&1&&(d(0,"div",0)(1,"div",1),b(2,"i",2),d(3,"span",3),v(4),h()(),d(5,"custom-button",4),O("click",function(){return e.restartGame()}),F(6,le,1,0,"img",5)(7,ce,1,0),h(),d(8,"div",1),b(9,"i",6),d(10,"span",7),v(11),h()()()),t&2&&(p(4),M(" ",e.flagsCounter(),""),p(2),E(6,e.gameOver()?7:6),p(5),M(" ",e.elapsedTime(),""))},dependencies:[N,ie],styles:['[_nghost-%COMP%]{--border-radius: .5rem;--control-border: .5px solid rgb(180, 180, 180);--control-border-focus: .5px solid rgb(146, 146, 250);--control-border-radius: var(--border-radius);--control-margin: 0 1rem 1rem 1rem;--control-padding: .5rem}.board-header[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;align-items:center;margin-bottom:1rem}.board-header[_ngcontent-%COMP%]   .board-header-display-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.5rem;background-color:#fff;border-radius:var(--border-radius)}.board-header[_ngcontent-%COMP%]   .board-header-display-container__icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:cover;height:1.5rem;width:1.5rem;display:block}.board-header[_ngcontent-%COMP%]   .board-header-display-container__icon.icon-bomb[_ngcontent-%COMP%]{background-image:url("./media/bomb-WMLRRMWI.png")}.board-header[_ngcontent-%COMP%]   .board-header-display-container__icon.icon-clock[_ngcontent-%COMP%]{background-image:url("./media/clock-6HG5APAF.svg")}.board-header[_ngcontent-%COMP%]   .board-header-display-container__label[_ngcontent-%COMP%]{margin-left:1rem;font-size:1.2rem}.board-header[_ngcontent-%COMP%]     .custom-button{border:none;margin-bottom:0}.board-header[_ngcontent-%COMP%]     .custom-button .board-header__face{background-repeat:no-repeat;background-size:cover;height:3rem;width:3rem}']});let n=i;return n})();var de=(n,i,o,r,t,e)=>({one:n,two:i,three:o,four:r,five:t,six:e});function me(n,i){if(n&1&&(d(0,"span",2),v(1),h()),n&2){let o=S();y("ngClass",q(2,de,o.tile.isNumber(1),o.tile.isNumber(2),o.tile.isNumber(3),o.tile.isNumber(4),o.tile.isNumber(5),o.tile.isNumber(6))),p(),M(" ",o.tile.getNumber()," ")}}var ue=(n,i,o,r)=>({filled:n,bomb:i,explosion:o,flag:r}),ae=(()=>{let i=class i{constructor(){this.TileTypes=u,this.tile=void 0,this.change=new K,this.gameOver=!1}updateType(){this.gameOver||this.tile&&(this.tile.isDiscovered()||this.tile.isFlag()||(this.tile.isTypeBomb()&&(this.tile.setType(this.TileTypes.EXPLOSION),this.tile.setDiscovered(!0)),(this.tile.isTypeBomb()||this.tile.isTypeEmpty()||this.tile.isTypeNumber())&&this.tile.setDiscovered(!0)))}onClick(){this.tile&&(this.updateType(),this.change.next(this.tile))}onContextMenuClick(r){r.preventDefault(),!this.gameOver&&this.tile&&(this.tile.isDiscovered()||(this.tile.setFlag(!this.tile.isFlag()),this.change.next(this.tile)))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=C({type:i,selectors:[["tile"]],inputs:{tile:"tile",gameOver:"gameOver"},outputs:{change:"change"},standalone:!0,features:[T],decls:2,vars:8,consts:[[1,"tile",3,"id","ngClass","click","contextmenu"],["class","tile__number",3,"ngClass"],[1,"tile__number",3,"ngClass"]],template:function(t,e){t&1&&(d(0,"span",0),O("click",function(){return e.onClick()})("contextmenu",function(m){return e.onContextMenuClick(m)}),F(1,me,2,9,"span",1),h()),t&2&&(y("id","tile-"+(e.tile==null?null:e.tile.getId()))("ngClass",Z(3,ue,!(e.tile!=null&&e.tile.isDiscovered())&&((e.tile==null?null:e.tile.isTypeEmpty())||(e.tile==null?null:e.tile.isTypeNumber())||(e.tile==null?null:e.tile.isTypeBomb())),(e.tile==null?null:e.tile.isDiscovered())&&(e.tile==null?null:e.tile.isTypeBomb()),(e.tile==null?null:e.tile.isDiscovered())&&(e.tile==null?null:e.tile.isTypeExplosion()),!(e.tile!=null&&e.tile.isDiscovered())&&(e.tile==null?null:e.tile.isFlag()))),p(),E(1,e.tile&&e.tile.getNumber()>0&&e.tile.isDiscovered()?1:-1))},dependencies:[ee,J],styles:['.tile[_ngcontent-%COMP%]{cursor:pointer;display:flex;justify-content:center;align-items:center;background-repeat:no-repeat;background-size:cover;height:2rem;width:2rem}.tile.filled[_ngcontent-%COMP%]{background-image:url("./media/filled-tile-RZHQON4O.svg")}.tile.flag[_ngcontent-%COMP%]{background-image:url("./media/flag-HK7GP6BV.svg")}.tile.bomb[_ngcontent-%COMP%]{background-image:url("./media/bomb-WMLRRMWI.png")}.tile.explosion[_ngcontent-%COMP%]{background-image:url("./media/explosion-2VWXHTOR.png")}.tile__number[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:bolder}.tile__number.one[_ngcontent-%COMP%]{color:#00f}.tile__number.two[_ngcontent-%COMP%]{color:#007800}.tile__number.three[_ngcontent-%COMP%]{color:red}.tile__number.four[_ngcontent-%COMP%]{color:#00007f}.tile__number.five[_ngcontent-%COMP%]{color:#7b0000}.tile__number.six[_ngcontent-%COMP%]{color:#a2ad00}']});let n=i;return n})();var ge=(n,i)=>i.getId();function pe(n,i){if(n&1){let o=$();d(0,"td",3)(1,"tile",4),O("change",function(t){Y(o);let e=S(2);return z(e.onTileChange(t))}),h()()}if(n&2){let o=i.$implicit,r=S(2);p(),y("tile",o)("gameOver",r.gameOver)}}function he(n,i){if(n&1&&(d(0,"tr",2),R(1,pe,2,2,"td",5,ge),h()),n&2){let o=i.$implicit;p(),A(o)}}function fe(n,i){n&1&&v(0," There were no items in the list. ")}var Ke=(()=>{let i=class i{constructor(r,t,e,s){this.router=r,this.configService=t,this.boardService=e,this.notificationService=s,this.ActionHelper=G,this.grid=[],this.gameOver=!1,this.gameStart=null,this.config=this.configService.getConfig()}ngOnInit(){this.configService.restoreConfig(),this.config=this.configService.getConfig(),this.newGame(),this.boardService.getResetGameObservable().subscribe(()=>{this.newGame()})}navigateToFinishedGameList(){this.router.navigateByUrl("/finished-games-list")}newGame(){this.notificationService.clear(),this.initGrid(),this.updateGridWithRandomBombs(),this.updateGridWithNumbers(),this.gameOver=!1,this.gameStart=null,this.boardService.startNewGame()}initGrid(){let r=0;for(let t=0;t<this.config.getRows();t++){this.grid[t]=[];for(let e=0;e<this.config.getColumns();e++){let s=new I;s.setId(++r),this.grid[t][e]=s}}}updateGridWithRandomBombs(){let r=0;for(;r<this.config.getBombs();){let t=Math.floor(Math.random()*this.config.getRows()),e=Math.floor(Math.random()*this.config.getColumns());this.grid[t][e].isTypeBomb()||(this.grid[t][e].setType(u.BOMB),r++)}}updateGridWithNumbers(){let r=(t,e)=>{let s=this.grid[t];if(s){let m=s[e];m&&!m.isTypeBomb()&&(m.setNumber(m.getNumber()+1),m.setType(u.NUMBER))}};for(let t=0;t<this.config.getRows();t++)for(let e=0;e<this.config.getColumns();e++)this.grid[t][e].isTypeBomb()&&(r(t-1,e-1),r(t,e-1),r(t+1,e-1),r(t-1,e),r(t+1,e),r(t-1,e+1),r(t,e+1),r(t+1,e+1))}updateFlagCounter(){let r=this.grid.flat().filter(t=>t.isFlag()).length;this.boardService.updateFlagCounter(r)}onTileChange(r){let t=r.getType();if(t===u.EXPLOSION&&!this.gameOver?(this.boardService.registerFinishedGameItem(this.gameStart,new Date,this.config.getDifficultyLevel(),L.LOOSE),this.boardService.gameOver(!0),this.gameOver=!0,this.notificationService.addError("Game Over!",G.buildFuctionAction({id:"try-again",label:"Try Again.",fn:()=>{this.newGame()},type:j.LINK})),this.grid.flat().forEach(e=>{!e.isDiscovered()&&e.isTypeBomb()&&e.setDiscovered(!0)})):t===u.EMPTY&&!r.isFlag()&&this.updateAdjacentTilesShowFlagWhenAEmptyTileWasClicked(r),!this.gameOver){let e=this.grid.flat().filter(s=>s.isDiscovered()&&!s.isTypeBomb()).length;e>0&&!this.gameStart&&(this.gameStart=new Date,this.boardService.startTimer()),e===this.config.getCells()-this.config.getBombs()&&(this.boardService.registerFinishedGameItem(this.gameStart,new Date,this.config.getDifficultyLevel(),L.WIN),this.boardService.gameOver(!1),this.notificationService.addSuccess("Game Won!",G.buildFinishedGameListAction({label:"Check your results.",type:j.LINK}))),this.updateFlagCounter()}}findRowAndColumn(r){let t=-1,e=-1;return this.grid.findIndex((s,m)=>{let g=s.findIndex(P=>P===r);return g!==-1?(t=m,e=g,!0):!1}),t!==-1&&e!==-1?{row:t,column:e}:{row:-1,column:-1}}updateAdjacentTilesShowFlagWhenAEmptyTileWasClicked(r){let t=this.findRowAndColumn(r),e=t?.row,s=t?.column,m=[],g=(c,a)=>c>-1&&a>-1&&c<this.config.getRows()&&a<this.config.getColumns()&&!m.some(l=>l.column===a&&l.row===c)?{row:c,column:a}:null,P=(c,a)=>{let l=[];return l.push(g(c-1,a-1)),l.push(g(c,a-1)),l.push(g(c+1,a-1)),l.push(g(c-1,a)),l.push(g(c+1,a)),l.push(g(c-1,a+1)),l.push(g(c,a+1)),l.push(g(c+1,a+1)),l.filter(B=>B!==null)},W=c=>{c.forEach(a=>{let l=a.row,B=a.column;if(this.grid[l]){let _=this.grid[l][B];if(_&&((_.isTypeEmpty()||_.isTypeNumber()&&!_.isFlag())&&_.setDiscovered(!0),_.isTypeEmpty())){let H=P(l,B);m.push(...H),W(H)}}})},x=P(e,s);m.push(...x),W(x)}};i.\u0275fac=function(t){return new(t||i)(f(te),f(k),f(D),f(ne))},i.\u0275cmp=C({type:i,selectors:[["app-board"]],standalone:!0,features:[T],decls:7,vars:2,consts:[["title","Board",1,"board",3,"actions"],[1,"board__grid"],[1,"row"],[1,"col"],[3,"tile","gameOver","change"],["class","col"],["class","row"]],template:function(t,e){t&1&&(d(0,"panel",0),b(1,"board-header"),d(2,"div",1)(3,"table"),R(4,he,3,0,"tr",6,Q,!1,fe,1,0),h()()()),t&2&&(y("actions",e.ActionHelper.buildBoardActions()),p(4),A(e.grid))},dependencies:[N,re,se,ae],styles:["[_nghost-%COMP%]{--border-radius: .5rem;--control-border: .5px solid rgb(180, 180, 180);--control-border-focus: .5px solid rgb(146, 146, 250);--control-border-radius: var(--border-radius);--control-margin: 0 1rem 1rem 1rem;--control-padding: .5rem}.board__grid[_ngcontent-%COMP%]{display:flex;justify-content:center}.board[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%], .board[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{border:1px solid #808080}"]});let n=i;return n})();export{Ke as BoardComponent};
