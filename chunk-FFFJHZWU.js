import{a as N}from"./chunk-P6DRUMU3.js";import{b as J}from"./chunk-JYSPU5UQ.js";import{a as k,b as R,c as F}from"./chunk-5RTQBFF4.js";import{a as Z}from"./chunk-TVHYCRZK.js";import{B as f,C,G as X,I as B,J as E,K as V,L as G,M as I,N as T,O as c,P as p,Q as b,R as $,S as y,T as O,W as j,X as v,Z as S,c as H,ha as K,k as U,pa as Q,t as Y,u as z,ua as q,v as P,va as A,z as h}from"./chunk-KC3GE5ZF.js";var D=class{constructor(){this.id=0,this.type=u.EMPTY,this.discovered=!1,this.flag=!1,this.number=0}getId(){return this.id}setId(i){this.id=i}getType(){return this.type}setType(i){this.type=i}isDiscovered(){return this.discovered}setDiscovered(i){this.discovered=i}getNumber(){return this.number}setNumber(i){this.number=i}setFlag(i){this.flag=i}isFlag(){return this.flag}isType(i){return this.getType()===i}isTypeEmpty(){return this.isType(u.EMPTY)}isTypeNumber(){return this.isType(u.NUMBER)}isTypeBomb(){return this.isType(u.BOMB)}isTypeExplosion(){return this.isType(u.EXPLOSION)}isNumber(i){return this.getNumber()===i}},u=function(r){return r[r.EMPTY=0]="EMPTY",r[r.NUMBER=1]="NUMBER",r[r.BOMB=2]="BOMB",r[r.EXPLOSION=4]="EXPLOSION",r}(u||{});function ne(r,i){r&1&&b(0,"img",5)}function re(r,i){r&1&&b(0,"img",6)}var te=(()=>{let i=class i{constructor(n,t,e){this.configService=n,this.boardService=t,this.cdr=e,this.timerIntervalSubscription=H.EMPTY,this.elapsedTime=P(0),this.flagsCounter=P(0),this.gameOver=P(!1)}ngOnInit(){this.resetFlagCounter(),this.boardService.getStartNewGameObservable().subscribe(()=>{this.startGame()}),this.boardService.getStartTimerObservable().subscribe(()=>{this.startTimer()}),this.boardService.getGameOverObservable().subscribe(n=>{this.gameOver.set(n),this.stopTimer()}),this.boardService.getUpdateFlagCounterObservable().subscribe(n=>{this.flagsCounter.set(this.configService.getConfig().getBombs()-n)})}ngOnDestroy(){this.stopTimer()}startTimer(){this.timerIntervalSubscription=U(1e3).subscribe(()=>{this.elapsedTime.set(this.elapsedTime()+1),this.cdr.detectChanges()})}stopTimer(){this.timerIntervalSubscription.unsubscribe()}startGame(){this.gameOver.set(!1),this.elapsedTime.set(0),this.resetFlagCounter()}restartGame(){this.boardService.resetGame(),this.startGame(),this.stopTimer()}resetFlagCounter(){this.flagsCounter.set(this.configService.getConfig().getBombs())}};i.\u0275fac=function(t){return new(t||i)(f(N),f(F),f(K))},i.\u0275cmp=C({type:i,selectors:[["board-header"]],decls:12,vars:3,consts:[[1,"board-header"],[1,"board-header-display-container"],[1,"board-header-display-container__icon","icon-bomb"],["id","flag-counter",1,"board-header-display-container__label"],[1,"board-header__button",3,"click"],["src","assets/icons/face_unpressed.svg","title","Restart Game",1,"board-header__face"],["src","assets/icons/face_loose.svg","title","Restart Game",1,"board-header__face"],[1,"board-header-display-container__icon","icon-clock"],["id","timer",1,"board-header-display-container__label"]],template:function(t,e){t&1&&(c(0,"div",0)(1,"div",1),b(2,"i",2),c(3,"span",3),v(4),p()(),c(5,"custom-button",4),y("click",function(){return e.restartGame()}),B(6,ne,1,0,"img",5)(7,re,1,0,"img",6),p(),c(8,"div",1),b(9,"i",7),c(10,"span",8),v(11),p()()()),t&2&&(h(4),S(" ",e.flagsCounter()),h(2),E(e.gameOver()?7:6),h(5),S(" ",e.elapsedTime()))},dependencies:[q],styles:["[_nghost-%COMP%]{--border-radius: .5rem;--control-border: .5px solid rgb(180, 180, 180);--control-border-focus: .5px solid rgb(146, 146, 250);--control-border-radius: var(--border-radius);--control-margin: 0 1rem 1rem 1rem;--control-padding: .5rem;--asset-icon-down-arrow: url(file://assets/icons/down-arrow.png);--asset-icon-filled-tile: url(file://assets/icons/filled-tile.svg);--asset-icon-flag: url(file://assets/icons/flag.svg);--asset-icon-bomb: url(file://assets/icons/bomb.png);--asset-icon-explosion: url(file://assets/icons/explosion.png);--asset-icon-clock: url(file://assets/icons/clock.svg)}.board-header[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;align-items:center;margin-bottom:1rem}.board-header[_ngcontent-%COMP%]   .board-header-display-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.5rem;background-color:#fff;border-radius:var(--border-radius)}.board-header[_ngcontent-%COMP%]   .board-header-display-container__icon[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:cover;height:1.5rem;width:1.5rem;display:block}.board-header[_ngcontent-%COMP%]   .board-header-display-container__icon.icon-bomb[_ngcontent-%COMP%]{background-image:var(--asset-icon-bomb)}.board-header[_ngcontent-%COMP%]   .board-header-display-container__icon.icon-clock[_ngcontent-%COMP%]{background-image:var(--asset-icon-clock)}.board-header[_ngcontent-%COMP%]   .board-header-display-container__label[_ngcontent-%COMP%]{margin-left:1rem;font-size:1.2rem}.board-header[_ngcontent-%COMP%]     .custom-button{border:none;margin-bottom:0}.board-header[_ngcontent-%COMP%]     .custom-button .board-header__face{background-repeat:no-repeat;background-size:cover;height:3rem;width:3rem}"]});let r=i;return r})();function oe(r,i){if(r&1&&(c(0,"span",2),v(1),p()),r&2){let d=O();j("one",d.tile.isNumber(1))("two",d.tile.isNumber(2))("three",d.tile.isNumber(3))("four",d.tile.isNumber(4))("five",d.tile.isNumber(5))("six",d.tile.isNumber(6)),h(),S(" ",d.tile.getNumber()," ")}}var ie=(()=>{let i=class i{constructor(){this.TileTypes=u,this.tile=void 0,this.change=new X,this.gameOver=!1}updateType(){this.gameOver||this.tile&&(this.tile.isDiscovered()||this.tile.isFlag()||(this.tile.isTypeBomb()&&(this.tile.setType(this.TileTypes.EXPLOSION),this.tile.setDiscovered(!0)),(this.tile.isTypeBomb()||this.tile.isTypeEmpty()||this.tile.isTypeNumber())&&this.tile.setDiscovered(!0)))}onClick(){this.tile&&(this.updateType(),this.change.next(this.tile))}onContextMenuClick(n){n.preventDefault(),!this.gameOver&&this.tile&&(this.tile.isDiscovered()||(this.tile.setFlag(!this.tile.isFlag()),this.change.next(this.tile)))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=C({type:i,selectors:[["tile"]],inputs:{tile:"tile",gameOver:"gameOver"},outputs:{change:"change"},decls:2,vars:10,consts:[[1,"tile",3,"click","contextmenu","id"],[1,"tile__number",3,"one","two","three","four","five","six"],[1,"tile__number"]],template:function(t,e){t&1&&(c(0,"span",0),y("click",function(){return e.onClick()})("contextmenu",function(m){return e.onContextMenuClick(m)}),B(1,oe,2,13,"span",1),p()),t&2&&(j("filled",!(e.tile!=null&&e.tile.isDiscovered())&&((e.tile==null?null:e.tile.isTypeEmpty())||(e.tile==null?null:e.tile.isTypeNumber())||(e.tile==null?null:e.tile.isTypeBomb())))("bomb",(e.tile==null?null:e.tile.isDiscovered())&&(e.tile==null?null:e.tile.isTypeBomb()))("explosion",(e.tile==null?null:e.tile.isDiscovered())&&(e.tile==null?null:e.tile.isTypeExplosion()))("flag",!(e.tile!=null&&e.tile.isDiscovered())&&(e.tile==null?null:e.tile.isFlag())),T("id","tile-"+(e.tile==null?null:e.tile.getId())),h(),E(e.tile&&e.tile.getNumber()>0&&e.tile.isDiscovered()?1:-1))},styles:[".tile[_ngcontent-%COMP%]{cursor:pointer;display:flex;justify-content:center;align-items:center;background-repeat:no-repeat;background-size:cover;height:2rem;width:2rem}.tile.filled[_ngcontent-%COMP%]{background-image:var(--asset-icon-filled-tile)}.tile.flag[_ngcontent-%COMP%]{background-image:var(--asset-icon-flag)}.tile.bomb[_ngcontent-%COMP%]{background-image:var(--asset-icon-bomb)}.tile.explosion[_ngcontent-%COMP%]{background-image:var(--asset-icon-explosion)}.tile__number[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:bolder}.tile__number.one[_ngcontent-%COMP%]{color:#00f}.tile__number.two[_ngcontent-%COMP%]{color:#007800}.tile__number.three[_ngcontent-%COMP%]{color:red}.tile__number.four[_ngcontent-%COMP%]{color:#00007f}.tile__number.five[_ngcontent-%COMP%]{color:#7b0000}.tile__number.six[_ngcontent-%COMP%]{color:#a2ad00}"]});let r=i;return r})();var se=(r,i)=>i.getId();function ae(r,i){if(r&1){let d=$();c(0,"td",3)(1,"tile",4),y("change",function(t){Y(d);let e=O(2);return z(e.onTileChange(t))}),p()()}if(r&2){let d=i.$implicit,n=O(2);h(),T("tile",d)("gameOver",n.gameOver)}}function le(r,i){if(r&1&&(c(0,"tr",2),G(1,ae,2,2,"td",3,se),p()),r&2){let d=i.$implicit;h(),I(d)}}function ce(r,i){r&1&&v(0," There were no items in the list. ")}var je=(()=>{let i=class i{constructor(n,t,e,o){this.router=n,this.configService=t,this.boardService=e,this.notificationService=o,this.ActionHelper=k,this.grid=[],this.gameOver=!1,this.gameStart=null,this.config=this.configService.getConfig()}ngOnInit(){this.configService.restoreConfig(),this.config=this.configService.getConfig(),this.newGame(),this.boardService.getResetGameObservable().subscribe(()=>{this.newGame()})}navigateToFinishedGameList(){this.router.navigateByUrl("/finished-games-list")}newGame(){this.notificationService.clear(),this.initGrid(),this.updateGridWithRandomBombs(),this.updateGridWithNumbers(),this.gameOver=!1,this.gameStart=null,this.boardService.startNewGame()}initGrid(){let n=0;for(let t=0;t<this.config.getRows();t++){this.grid[t]=[];for(let e=0;e<this.config.getColumns();e++){let o=new D;o.setId(++n),this.grid[t][e]=o}}}updateGridWithRandomBombs(){let n=0;for(;n<this.config.getBombs();){let t=Math.floor(Math.random()*this.config.getRows()),e=Math.floor(Math.random()*this.config.getColumns());this.grid[t][e].isTypeBomb()||(this.grid[t][e].setType(u.BOMB),n++)}}updateGridWithNumbers(){let n=(t,e)=>{let o=this.grid[t];if(o){let m=o[e];m&&!m.isTypeBomb()&&(m.setNumber(m.getNumber()+1),m.setType(u.NUMBER))}};for(let t=0;t<this.config.getRows();t++)for(let e=0;e<this.config.getColumns();e++)this.grid[t][e].isTypeBomb()&&(n(t-1,e-1),n(t,e-1),n(t+1,e-1),n(t-1,e),n(t+1,e),n(t-1,e+1),n(t,e+1),n(t+1,e+1))}updateFlagCounter(){let n=this.grid.flat().filter(t=>t.isFlag()).length;this.boardService.updateFlagCounter(n)}onTileChange(n){let t=n.getType();if(t===u.EXPLOSION&&!this.gameOver?(this.boardService.registerFinishedGameItem(this.gameStart,new Date,this.config.getDifficultyLevel(),R.LOOSE),this.boardService.gameOver(!0),this.gameOver=!0,this.notificationService.addError("Game Over!",k.buildFuctionAction({id:"try-again",label:"Try Again.",fn:()=>{this.newGame()},type:A.LINK})),this.grid.flat().forEach(e=>{!e.isDiscovered()&&e.isTypeBomb()&&e.setDiscovered(!0)})):t===u.EMPTY&&!n.isFlag()&&this.updateAdjacentTilesShowFlagWhenAEmptyTileWasClicked(n),!this.gameOver){let e=this.grid.flat().filter(o=>o.isDiscovered()&&!o.isTypeBomb()).length;e>0&&!this.gameStart&&(this.gameStart=new Date,this.boardService.startTimer()),e===this.config.getCells()-this.config.getBombs()&&(this.boardService.registerFinishedGameItem(this.gameStart,new Date,this.config.getDifficultyLevel(),R.WIN),this.boardService.gameOver(!1),this.notificationService.addSuccess("Game Won!",k.buildFinishedGameListAction({label:"Check your results.",type:A.LINK}))),this.updateFlagCounter()}}findRowAndColumn(n){let t=-1,e=-1;return this.grid.findIndex((o,m)=>{let g=o.findIndex(M=>M===n);return g!==-1?(t=m,e=g,!0):!1}),t!==-1&&e!==-1?{row:t,column:e}:{row:-1,column:-1}}updateAdjacentTilesShowFlagWhenAEmptyTileWasClicked(n){let t=this.findRowAndColumn(n),e=t?.row,o=t?.column,m=[],g=(l,s)=>l>-1&&s>-1&&l<this.config.getRows()&&s<this.config.getColumns()&&!m.some(a=>a.column===s&&a.row===l)?{row:l,column:s}:null,M=(l,s)=>{let a=[];return a.push(g(l-1,s-1)),a.push(g(l,s-1)),a.push(g(l+1,s-1)),a.push(g(l-1,s)),a.push(g(l+1,s)),a.push(g(l-1,s+1)),a.push(g(l,s+1)),a.push(g(l+1,s+1)),a.filter(w=>w!==null)},x=l=>{l.forEach(s=>{let a=s.row,w=s.column;if(this.grid[a]){let _=this.grid[a][w];if(_&&((_.isTypeEmpty()||_.isTypeNumber()&&!_.isFlag())&&_.setDiscovered(!0),_.isTypeEmpty())){let W=M(a,w);m.push(...W),x(W)}}})},L=M(e,o);m.push(...L),x(L)}};i.\u0275fac=function(t){return new(t||i)(f(Q),f(N),f(F),f(J))},i.\u0275cmp=C({type:i,selectors:[["app-board"]],decls:7,vars:2,consts:[["title","Board",1,"board",3,"actions"],[1,"board__grid"],[1,"row"],[1,"col"],[3,"change","tile","gameOver"]],template:function(t,e){t&1&&(c(0,"panel",0),b(1,"board-header"),c(2,"div",1)(3,"table"),G(4,le,3,0,"tr",2,V,!1,ce,1,0),p()()()),t&2&&(T("actions",e.ActionHelper.buildBoardActions()),h(4),I(e.grid))},dependencies:[Z,te,ie],styles:["[_nghost-%COMP%]{--border-radius: .5rem;--control-border: .5px solid rgb(180, 180, 180);--control-border-focus: .5px solid rgb(146, 146, 250);--control-border-radius: var(--border-radius);--control-margin: 0 1rem 1rem 1rem;--control-padding: .5rem;--asset-icon-down-arrow: url(file://assets/icons/down-arrow.png);--asset-icon-filled-tile: url(file://assets/icons/filled-tile.svg);--asset-icon-flag: url(file://assets/icons/flag.svg);--asset-icon-bomb: url(file://assets/icons/bomb.png);--asset-icon-explosion: url(file://assets/icons/explosion.png);--asset-icon-clock: url(file://assets/icons/clock.svg)}.board[_ngcontent-%COMP%]{view-transition-name:scale3d}.board__grid[_ngcontent-%COMP%]{display:flex;justify-content:center}.board[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%], .board[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{border:1px solid #808080}"]});let r=i;return r})();export{je as BoardComponent};
